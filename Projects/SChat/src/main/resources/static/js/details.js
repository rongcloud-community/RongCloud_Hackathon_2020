define("details",["init"],function(a){a("init");var t=UE.getEditor("editor",{serverUrl:"/Upload/ueditorUpload",toolbars:[["bold","emotion","forecolor","link","unlink","fontsize","fontfamily"]],enableAutoSave:!1,wordCount:!1,autoSyncData:!1,emotionLocalization:!0,wordOverFlowMsg:""}),e=UE.getEditor("editor2",{serverUrl:"/Upload/ueditorUpload",toolbars:[["bold","emotion","forecolor","link","unlink","fontsize","fontfamily"]],enableAutoSave:!1,wordCount:!1,autoSyncData:!1,emotionLocalization:!0,wordOverFlowMsg:""}),n=$("#replay2");!function(){function a(a){var t=$(".jsCode").eq(a)[0];if(t){var e="",n="/vv//";e=-1!=t.src.indexOf(n)?t.src.substring(0,t.src.indexOf(n)+n.length):t.src+n,t.src=e+Math.random(),$("#verifyCode,#verifyCode2").val("")}}$(document).on("click",".jsReply",function(){var a=$(this);if("取消"==a.html())n.hide(),a.html("回复");else{a.parents(".itemMain").after(n.show()),$(".jsReply").html("回复"),a.html("取消");var t=a.attr("data-id");$("#replyForm2").find("input[name='parent_id']").val(t)}var e=!!window.ActiveXObject,i=e&&!window.XMLHttpRequest;e&&i&&(document.body.style.zoom=1.1,document.body.style.zoom="")}),$("#ueSubmit").on("click",function(){var e=$.trim(t.getPlainTxt());if(!e)return void $.alert("内容不能为空");var n=$("#replyForm"),i=$(this).attr("data-type"),s=(n.find("input[name='parent_id']"),n.find("input[name='content']")),o=new RegExp("&#39;","gi"),r=$.trim(t.getContent()).replace(o,"");s.val(r),$.ajax({url:n.attr("action"),type:n.attr("method"),dataType:"json",data:n.serializeArray(),success:function(e){if(e.status){var s=e.data,o="",r="";switch(s.role){case 1:r="nickname s-fc2";break;case 2:r="nickname s-fc4",o="<em>FMT&nbsp;-&nbsp;</em>";break;case 3:r="nickname s-fc4",o="<em>Admin&nbsp;-&nbsp;</em>"}var l="";1==i&&(l+='<div class="add-star" ><span class="star-icon" data-fornum_id="'+s.reply_id+'"></span><b>0</b></div>');var c='<div class="cmtItem"><span class="badge red" style="display:none;">沙发</span><div class="itemMain"><div class="avatar"><img src="'+s.avatar+'" height="60" width="60"><i class="cover"></i></div><dl class="container"><dt class="title"><span class="'+r+'">'+o+s.nick_name+'</span><span class="time"></span><span class="time"><a class="jsDelete" href="javascript:;" data-id="'+s.reply_id+'">[删除]</a></span></dt><dd class="content f-wwb">'+s.content+l+'<a class="reply jsReply" href="javascript:;" data-id="'+s.reply_id+'" data-name="'+s.nick_name+'">回复</a></dd></dl></div>',d=$(c),f=d.find(".badge");$(".m-comment>.cmtItem").length>0?$(".m-comment>.cmtItem").last().after(d):n.before(d);var m=$(".m-comment>.cmtItem"),u=m.length;switch(u){case 1:f.html("沙发").removeClass("green blue").addClass("red").show();break;case 2:f.html("板凳").removeClass("red blue").addClass("green").show();break;case 3:f.html("地板").removeClass("red green").addClass("blue").show()}$(".star-icon").on("click",function(){var a=$(this),t=parseInt(a.next("b").html()),e=a.next("b"),n=a.attr("data-fornum_id");if(a.hasClass("add-star-cion"))var i="/ajax/cancelPraise",s=t-1;else var i="/ajax/praiseLog",s=t+1;$.ajax({type:"POST",url:i,dataType:"json",data:{forum_id:n,type:2},success:function(t){t.status?(a.toggleClass("add-star-cion"),e.html(s)):$.alert(t.info,function(){t.data&&(location.href=t.data)})}})}),d.find(".time").eq(0).html(u+"楼&nbsp;"+s.date),m.removeClass("last").last().addClass("last"),a(1),t.setContent("")}else"codeError"==e.data&&a(1),$.alert(e.info,function(){e.data&&"codeError"!=e.data&&(location.href=e.data)});1==e.data.is_verify&&$("form .fn-left").show()},error:function(){$.alert("网络连接失败！")}})}),$("#ueSubmit2").on("click",function(){var t=$.trim(e.getPlainTxt());if(!t)return void $.alert("内容不能为空");var i=$("#replyForm2"),s=(i.find("input[name='parent_id']"),i.find("input[name='content']")),o=new RegExp("&#39;","gi"),r=$.trim(e.getContent()).replace(o,"");s.val(r),$.ajax({url:i.attr("action"),type:i.attr("method"),dataType:"json",data:i.serializeArray(),success:function(t){if(t.status){var i=t.data,s="",o="";switch(i.role){case 1:o="nickname s-fc2";break;case 2:o="nickname s-fc4",s="<em>FMT&nbsp;-&nbsp;</em>";break;case 3:o="nickname s-fc4",s="<em>Admin&nbsp;-&nbsp;</em>"}var r='<div class="itemSub"><div class="avatar"><img src="'+i.avatar+'" height="50" width="50" ><i class="cover"></i></div><dl class="container"><dt class="title"><span class="'+o+'">'+s+i.nick_name+'</span><span class="time">'+i.date+'</span><span class="time"><a class="jsDelete" href="javascript:;" data-id="'+i.reply_id+'">[删除]</a></span></dt><dd class="content f-wwb">'+i.content+"</dd></dl></div>",l=$(r),c=n.parents(".cmtItem");n.hide(),c.append(l),$(".jsReply").html("回复"),c.find(".itemSub").removeClass("last").last().addClass("last"),a(0),e.setContent("")}else"codeError"==t.data&&a(0),$.alert(t.info,function(){t.data&&"codeError"!=t.data&&(location.href=t.data)});1==t.data.is_verify&&$("form .fn-left").show()},error:function(){$.alert("网络连接失败！")}})}),$("#verifyCode").on("keydown",function(a){return 13==a.keyCode?!1:void 0})}(),$(".jsDelete").live("click",function(){var a=$(this).attr("data-id");$.confirm("确定要删除此条回复吗？",function(){$.ajax({url:"/ajax/delReply",type:"post",dataType:"json",data:{reply_id:a},success:function(a){a.status?($.alert(a.info,function(){location.reload()}),setTimeout(function(){location.reload()},3e3)):$.alert(a.info)}})})}),$(".jsOperate").on("click",function(){var a=$(this),t=a.attr("type"),e=$("#forum_id").val(),n=a.html();$.confirm("您确定要执行"+n+"操作吗?",function(){$.ajax({url:"/ajax/forumAction",type:"post",dataType:"json",data:{type:t,id:e},success:function(a){a.status?($.alert("操作成功！"),setTimeout(function(){location.href="/forum/index"},1e3)):$.alert(a.info)},error:function(){$.alert("网络连接失败！")}})})}),$(".jsSignUp").live("click",function(){var a=$(this),t=a.attr("data-id"),e="/Ajax/openClassApply";$.ajax({url:e,type:"GET",dataType:"json",data:{id:t},success:function(t){if(1==t.status){$.alert(t.info);var e=a.parents(".clist-li").find(".fontH span");a.html("进入教室").removeClass("jsSignUp").prev().show(),e.html(1*e.html()+1)}else 2==t.status?$.confirm(t.info,function(){window.open(t.data)},$.noop,"我也要付费","算了，学别的"):$.alert(t.info,function(){t.data&&(location.href=t.data)})},error:function(){$.alert("网络连接失败！")}}),event.preventDefault()}),$(".u-cancel").on("click",function(){var a=$(this),t=a.next(),e=t.attr("data-id"),n="/Ajax/openClassCancel";$.ajax({url:n,type:"GET",dataType:"json",data:{id:e},success:function(e){if(1==e.status){$.alert(e.info);var n=a.parents(".clist-li").find(".fontH span");a.hide(),t.html("预约").addClass("jsSignUp"),n.html(1*n.html()-1)}else $.alert(e.info,function(){e.data&&(location.href=e.data)})},error:function(){$.alert("网络连接失败！")}})}),$(".jsPlay").on("click",function(){var a=$(this),t=a.attr("data-aid"),e=(a.attr("data-type"),a.attr("data-joined")||0),n=1*$("#count").html();if(1==e)var i="/Ajax/activityCancel";else var i="/Ajax/activityApply";$.ajax({url:i,type:"POST",dataType:"json",data:{activity_id:t,action:2},success:function(t){t.status?($.alert(t.info),a.attr("data-joined",1^e),1==e?(a.html("我要玩"),$("#count").html(n-1)):(a.html("不玩了"),$("#count").html(n+1))):$.alert(t.info,function(){t.data&&(location.href=t.data)})},error:function(){$.alert("网络连接失败！")}})}),$(".jsSignUp2").on("click",function(){var a=$(this),t=a.attr("data-id"),e=a.attr("data-joined")||0,n=1*$("#count").html();if(1==e)var i="/Ajax/openClassCancel";else var i="/Ajax/openClassApply";$.ajax({url:i,type:"GET",dataType:"json",data:{id:t},success:function(t){t.status?($.alert(t.info),a.attr("data-joined",1^e),1==e?(a.html("预约").removeClass("gray"),$("#count").html(n-1)):(a.html("取消预约").addClass("gray"),$("#count").html(n+1))):$.alert(t.info,function(){t.data&&(location.href=t.data)})},error:function(){$.alert("网络连接失败！")}})})});